@use 'utilities' as *;



// For maths.
:root {
	--typography--cap-height--gill-sans: 0.681; // In em. Unitless for use in calc.
	--typography--cap-height--verdana:   0.727;

	--typography--x-height--gill-sans: 0.448;
	--typography--x-height--verdana:   0.546;
}

// Font metrics.
%--shoulders {
	--typography--shoulder:      calc(1 - var(--typography--cap-height)); // Remainder/overhang.
	--typography--shoulder--top: calc(var(--typography--shoulder) - var(--typography--shoulder--bottom));

	--typography--underline--clear:  1; // “True,” moves underline fully south of descender.
}



%font--gill-sans {
	@extend %--shoulders;
	@extend %--safari--rounding;

	--typography--cap-height:        var(--typography--cap-height--gill-sans);
	--typography--x-height:          var(--typography--x-height--gill-sans);
	--typography--shoulder--bottom:  0.157; // Vertical centering in the line box, across most sizes.

	--typography--inset--left:      -0.076; // Optical insets, left edge of capital "D".
	--typography--inset--right:     -0.058; // Right edge of “d” (since lines tend to end lowercase).

	--typography--underline:         0.080; // Height of crossbar on “t”.
	--typography--underline--shift: -0.069; // Shift down from baseline, to line up with bottom of descenders.

	font-family: 'Gill Sans', sans-serif;

	// Gill Sans on Windows is unreliable, so go for consistent Verdana.
	@at-root { :root.windows & { @extend %font--verdana } }
}

%font--gill-sans--on-verdana {
	@extend %font--gill-sans;

	// Match cap heights of Gill to Verdana.
	--typography--size--override:    calc(var(--typography--cap-height--verdana) / var(--typography--cap-height--gill-sans) * var(--typography--size));

	// But cancel this out in the leading.
	--typography--leading--override: calc(var(--typography--cap-height--gill-sans) / var(--typography--cap-height--verdana) * var(--typography--leading));
}

%font--gill-sans--x-verdana-cap { // Match x-height to Verdana caps.
	@extend %font--gill-sans--on-verdana;

	--typography--scale: calc(var(--typography--cap-height--gill-sans) / var(--typography--x-height--gill-sans));
}



%font--verdana {
	@extend %--shoulders;
	@extend %--safari--rounding;

	--typography--cap-height:        var(--typography--cap-height--verdana);
	--typography--x-height:          var(--typography--x-height--verdana);
	--typography--shoulder--bottom:  0.103;

	--typography--inset--left:      -0.098;
	--typography--inset--right:     -0.090;

	--typography--underline:         0.078;
	--typography--underline--shift: -0.045;

	font-family: 'Verdana', sans-serif;
}



%font--uppercase { text-transform: uppercase }

%font--extended {
	--typography--tracking: calc(1 / 6);

	--typography--inset--right--override: calc(var(--typography--inset--right) - var(--typography--tracking));
}



// Adjustments for Safari whole-point rounding (up to 18pt), lower for cascade.
%--safari--rounding {
	@include browser(safari) {
		--typography--underline:         0.056;
		--typography--underline--shift: -0.089;
	}
}
